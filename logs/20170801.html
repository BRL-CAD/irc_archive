<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
 <title>IRC log for #brlcad on 20170801</title>
 <meta name="generator" content="irclog2html.pl">
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body text="#000000" bgcolor="#ffffff">
<h1>IRC log for #brlcad on 20170801</h1>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Default -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-1563266826402652"
     data-ad-slot="5026919875"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<form action="http://www.google.com" id="cse-search-box">
  <div>
    <input type="hidden" name="cx" value="partner-pub-1563266826402652:3301963896" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<table cellspacing=3 cellpadding=2 border=0>
<tr bgcolor="#eeeeee"><td><tt>00:17.03</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:mdtwenty * 70033 (brlcad/branches/opencl/include/rt/shoot.h brlcad/branches/opencl/src/librt/primitives/bool.cl and 3 others): skipping unevaluated partitions</tt></td></tr>
<tr><td><tt>00:18.06</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad https_GK1wmSU (~deep-book@169.55.27.131)</font></tt></td></tr>
<tr><td><tt>00:19.05</tt></td><td colspan=2><tt><font color="#000099">*** part/#brlcad https_GK1wmSU (~deep-book@169.55.27.131)</font></tt></td></tr>
<tr><td><tt>00:38.53</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad sqrosuofcvzwzywq (~armin@dslb-094-216-164-255.094.216.pools.vodafone-ip.de)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>00:41.13</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Marco-domingues * 10149 /wiki/User:Marco-domingues/GSoC17/Log: /* 31 July */</tt></td></tr>
<tr><td><tt>02:13.37</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad yukonbob (~bch@S0106b81619e90b96.ok.shawcable.net)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>02:13.40</tt></td><td><font color="#b2b25e"><tt>yukonbob</tt></font></td><td width="100%"><tt>hello #brlcad</tt></td></tr>
<tr><td><tt>02:43.36</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad https_GK1wmSU (~deep-book@77.234.42.183)</font></tt></td></tr>
<tr><td><tt>02:44.37</tt></td><td colspan=2><tt><font color="#000099">*** part/#brlcad https_GK1wmSU (~deep-book@77.234.42.183)</font></tt></td></tr>
<tr><td><tt>03:34.33</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad gabbar1947 (uid205515@gateway/web/irccloud.com/x-uthcarhicquzqbhn)</font></tt></td></tr>
<tr><td><tt>05:55.07</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@20-21-132-95.pool.ukrtel.net)</font></tt></td></tr>
<tr><td><tt>06:45.42</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad Caterpillar (~caterpill@unaffiliated/caterpillar)</font></tt></td></tr>
<tr><td><tt>07:14.18</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK (~Kim__@2600:8803:7a81:7400:8dd6:e12e:6013:7834)</font></tt></td></tr>
<tr><td><tt>07:15.00</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK (~Kim__@2600:8803:7a81:7400:8dd6:e12e:6013:7834)</font></tt></td></tr>
<tr><td><tt>07:18.05</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>07:27.36</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>07:53.52</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad Stragus_ (~alexis@modemcable131.0-202-24.mc.videotron.ca)</font></tt></td></tr>
<tr><td><tt>08:14.30</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@user-94-45-58-139.skif.com.ua)</font></tt></td></tr>
<tr><td><tt>08:25.19</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad Caterpillar (~caterpill@unaffiliated/caterpillar)</font></tt></td></tr>
<tr><td><tt>08:34.02</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr><td><tt>08:39.31</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr><td><tt>08:42.54</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr><td><tt>08:51.44</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>09:11.44</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>09:15.52</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK_ (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr><td><tt>09:17.31</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK_ (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr><td><tt>09:21.01</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK_ (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr><td><tt>09:32.36</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad gabbar1947 (uid205515@gateway/web/irccloud.com/x-ltbxxbrtphejfhrl)</font></tt></td></tr>
<tr><td><tt>09:33.46</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>10:30.52</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>11:55.55</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Amritpal singh * 10150 /wiki/User:Amritpal_singh/GSoC17/logs: /* Coding Period */</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>12:02.13</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Amritpal singh * 0 /wiki/File:Bentrebar.png: </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>12:07.20</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Amritpal singh * 0 /wiki/File:PopimageUshapeRebar.png: </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>12:08.05</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Amritpal singh * 10153 /wiki/User:Amritpal_singh/GSoC17/logs: /* Coding Period */</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>12:09.25</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Amritpal singh * 10154 /wiki/User:Amritpal_singh/GSoC17/logs: /* Coding Period */</tt></td></tr>
<tr><td><tt>12:20.59</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>13:22.06</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad gabbar1947 (uid205515@gateway/web/irccloud.com/x-uzhthiaatgjhxdcu)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>13:35.38</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:mdtwenty * 70034 brlcad/branches/opencl/src/librt/primitives/rt.cl: Fix bug in partitions shading. Shading closest partition</tt></td></tr>
<tr><td><tt>13:39.29</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad yorik (~yorik@2804:431:f720:4929:290:f5ff:fedc:3bb2)</font></tt></td></tr>
<tr><td><tt>13:39.45</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad vasc (~vasc@bl4-147-121.dsl.telepac.pt)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>13:41.09</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Marco-domingues * 0 /wiki/File:Shade_closest_partition.png: </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>13:48.37</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:Marco-domingues * 10156 /wiki/User:Marco-domingues/GSoC17/Log: /* 1 August */</tt></td></tr>
<tr><td><tt>14:16.26</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad mdtwenty (bc519789@gateway/web/freenode/ip.188.81.151.137)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:21.57</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>hey mdtwenty </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:22.07</tt></td><td><font color="#63bdbd"><tt>mdtwenty</tt></font></td><td width="100%"><tt>hello!</tt></td></tr>
<tr><td><tt>14:22.38</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad mdtwenty[m] (mdtwentyma@gateway/shell/matrix.org/x-zzjodrxmmmvwtbhh)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:23.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>once you put the changes to skip unevaluated partitions and the bug fix for the closest partition on svn then tell me so i can look at the code</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:23.15</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>about bool_eval()...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:23.35</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>did you see patch i posted on the patches tracker?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:23.51</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:24.22</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>I have commited the changes already in the opencl branch</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:24.58</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://sourceforge.net/p/brlcad/patches/473/">https://sourceforge.net/p/brlcad/patches/473/</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:24.58</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ BRL-CAD / Patches / #473 Eliminate gotos from bool_eval() ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:25.34</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>apply this patch to brlcad trunk/ and try running your tests on that to see what's the performance difference vs the old code.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:25.59</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if that's fast enough, then we can work on a simplified prototype in ANSI C to port to OpenCL later.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:26.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>with a linearized binary tree in an array, instead of storing the expression tree in rpn format.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:26.32</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so the tree would be in infix notation.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:27.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it shouldn't even use more memory if we do it right. </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:27.43</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>hm okay I will apply the patch and test it</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:28.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ok. i'll try to advance the pseudocode for the solution to speed this up.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:28.58</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>yeah I think most of the bugs with the csg code are fixed now</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:31.19</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>the images match the results from the ANSI C code, although some scenes have missing geometry from the primitives that are not supported yet (goliath.g is one example of this, where some pipes are missing)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:31.33</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i'm gonna need to know the first material in a solid so i can shade the primitives properly in the one-hit shader though.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:31.45</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah pipe is used quite often.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:32.15</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but the code is kinda more complicated than that of regular primitive. that's why i didn't ask you to work on it.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:32.28</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>pipe is a composite primitive.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:32.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>its a list of segments of things.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:33.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it would distract from the purpose of getting the csg working.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:33.51</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>let's see...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:34.16</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i need some data structure.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:34.17</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>hm yes I remember you saying that porting that primitive would take some work</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:35.21</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>in case you're curious you can look at src/librt/primitives/pipe/pipe_shot.c or something like that.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:36.04</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://svn.code.sf.net/p/brlcad/code/brlcad/trunk/src/librt/primitives/pipe/pipe.c">https://svn.code.sf.net/p/brlcad/code/brlcad/trunk/src/librt/primitives/pipe/pipe.c</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:36.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if you do a 'wc -l' to get a linecount on the pipe.c file vs, say, ehy.c you would see that's it's a lot more complex.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:37.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>anyway...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:38.07</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>implementing bool_eval() is easier than that.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:38.15</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>seriously.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:40.36</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>hm yes lets first optimize the code and then I can look into porting some more primitives into OpenCL :)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:42.58</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>nah.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:43.05</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we want to optimize this to the max.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:43.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>screw the primitives.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:43.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we only have one month.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:44.01</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>ah yes, I meant eventually after the gsoc period</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:44.16</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>maybe next year. :-)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:45.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and mind you, implementing pipe would be a breeze compared to the other main ticket item left to do... the brep intersector.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:45.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>gah.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:45.49</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>that's another gsoc or two.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:46.36</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if we get all that working, i think this will have a more complete GPU intersector than ANYTHING ELSE in the market right now.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:47.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if it happens.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:47.16</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>anyway...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:51.27</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we'll use something like this bin tree representation</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:51.32</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://github.com/mmp/pbrt-v2/blob/master/src/core/kdtree.h">https://github.com/mmp/pbrt-v2/blob/master/src/core/kdtree.h</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:51.33</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ pbrt-v2/kdtree.h at master Â· mmp/pbrt-v2 Â· GitHub ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:52.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>that's for a spatial kd-tree, but the data structure is more or less the same a bintree. in fact ours is simpler because we don't need to store as much data on the nodes.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>14:59.31</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>okay, IIRC the idea is to store the jumps in the data structure, along with the boolean tree information?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.14</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yes.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>this is the data structure the code uses now:</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>union tree {</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.38</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.40</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.42</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.46</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.48</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.50</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.52</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.54</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.56</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:00.58</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.02</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.04</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.06</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.14</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.16</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.18</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.21</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.25</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.27</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.33</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.35</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>};</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and this is what we'll use: (pseudo-code)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.41</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>/ assume NOPs have been removed and all leafs are SOLIDs.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.43</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>/ pseudo-code.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.45</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>struct tree {</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.47</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.49</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.51</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.55</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.57</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:01.59</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:02.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:02.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:02.05</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>};</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:02.07</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ta-da.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:02.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>a linearized array binary tree.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:02.24</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>where nodes are either branches with binary ops (has_lchild = 1) or leafs with solids (has_lchild = 0)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:03.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the current code is a horrible, horrible waste of memory and has lotsa pointer chasing.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:03.19</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we're gonna fix that.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:04.06</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Having the whole acceleration structure as a big linear blob of memory is good, and you can use relative offsets to jump around</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:05.06</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>16 or 32 bits with a &lt;&lt; 4 is pretty good. 32 bits is easier, 16 bits involves a complicated shuffling/ordering solution</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:05.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>right. when it's a branch, left child is always at current_offset+1, and the right child is that current_offset+tree.rchild. or was that tree.rchild. i don't remember.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:05.24</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Ah, or that</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:06.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so each tree node should fit into 32-bits.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:06.18</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>4 bytes.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:06.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>instead of... 4*2 + 8*3 bytes.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:06.56</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>32</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:07.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>8x smaller.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:07.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and not as much pointer chasing.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:07.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:07.42</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>that's the whole idea.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:08.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>now the small detail of getting it to work.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:08.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>"small detail"</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:08.52</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>*nods* My raytracers always used a linear blob of memory for each graph. Another wonderful detail is that you can save the blob to disk and use "as is", you can use on both CPU and GPU directly, it just works</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:09.24</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yes. we'll use a simple recursive function the CPU to linearize this tree, and then we'll just copy that to the GPU.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:10.33</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Linearizing on CPU would be a good idea too</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:10.46</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>(and it makes things easier, same data structure everywhere)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:18.59</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>meh... the code for the kd-tree in pbrt is too complicated. i think I also saw this in Wald's thesis someplace.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:21.47</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>I think I first read about this in Gordon Stoll's SIGGRAPH presentation.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:22.48</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>hmmm...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:23.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i probably has some of my own code someplace with this.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:23.11</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>have</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.00</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>I've just tested your patch (<a href="https://sourceforge.net/p/brlcad/patches/473/)">https://sourceforge.net/p/brlcad/patches/473/)</a> and it seems to match the current times with the version on the trunk</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.01</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ A 404 Error has Occurred ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ok, but what about the times?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.18</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.21</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>great.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.34</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so we got ourselves an algorithm without gotos.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.36</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>goliath is the same (0.33 vs 0.33)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:24.47</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>which can't be used in OpenCL.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:25.21</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>now we need an algorithm without gotos, wasted memory, needless pointer chasing, and no dynamic memory.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:25.32</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>havoc (0.62 new version vs 0.63 in the trunk)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:25.33</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>that takes care of the first problem.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:25.35</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>so no big difference</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:25.47</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah, that could just be measuring error.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:25.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>should be anyway.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:26.33</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you wanna code the ANSI C prototype?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:27.09</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>yeah I can give it a try!</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:27.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we basically need to code a tree builder and a tree traverser.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:31.06</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i was trying to find some of my old code so you could use that as a base.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:33.26</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ah well.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:33.46</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>dunno if it survived my HD crash 3 years ago.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:37.24</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>meh. finding mostly code snippets of bin trees accessed with shifts.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:37.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but that means it has to be a balanced bin tree, or it wastes a lot of memory so...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:38.52</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>anyway</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://pastebin.com/R4SZpDMD">https://pastebin.com/R4SZpDMD</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.13</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ [C] #define OP_UNION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /**&lt; @brief&nbsp;&nbsp;Binary: L union R */&nbsp;&nbsp;#define OP_INTERS - Pastebin.com ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.15</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>this should help</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.42</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i don't want you to waste a lot of time reinventing things that have already been invented.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so we can use the remaining time to actually invent new stuff.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.57</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>:-)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:43.49</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>start by building the tree builder, that converts a trunk/ union tree into that array of uints with the layout i mentioned before, and a function to print it to examine the output.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:44.38</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you can use the KdTree() constructor and recursiveBuild() function I put in the pastebin from PBRT as a reference.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:45.04</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but you'll need to use shifts and things like that to store things in 32-bits.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:45.19</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>because OpenCL does not have support for bitfields in structs either.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:45.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>gotta love OpenCL.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:46.08</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Managing the bits yourself sometimes allows producing better code than with bitfields anyway</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:46.18</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://stackoverflow.com/questions/9033947/why-are-bitfields-not-allowed-in-opencl">https://stackoverflow.com/questions/9033947/why-are-bitfields-not-allowed-in-opencl</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:46.19</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ bit fields - Why are bitfields not allowed in OpenCL? - Stack Overflow ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:47.14</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ah so it's because of endianess? bah.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:47.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>then what about ints? those would need to be converted too...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:47.36</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><font color="#CC00CC">scratches his head.</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:48.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so it's just because of padding it seems.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:49.18</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>anyway the idea is the first bit says if its a branch or a leaf. if it's a branch the next 3 bits define the binary OP, and the remaining bits where right child is.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:49.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if it's a leaf, then the other 30 bits have the solid id.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:49.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>that's it.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:49.49</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>31 bits actually</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:50.15</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i hope 2G solids are enough.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:51.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and like 256 M bool nodes.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:51.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if it's not enough we can use 64 bits.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:53.49</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>mdtwenty[m], thx for conducting the tests.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:53.59</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i'll look at your code now.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:54.27</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>no worries :)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:54.45</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>i think I got the idea.. I will start working on this and see what I can get</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:55.40</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>sure. if your ANSI C prototype code turns out to be faster than the one in trunk/ then we can ask Sean to test it and maybe we'll use it in the main ANSI C path as well.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:56.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it might be because the nodes are going to be smaller and the memory accesses more coherent.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:56.33</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>although i haven't looked at how the code allocates the nodes yet.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:00.17</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you can use the RPN bool patch I made way back when to see which functions you need to implement to completely replace the existing boolean trees in trunk/.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:02.04</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>okay thanks! I'll keep that in mind</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:02.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but like i said, start with the tree builder and the print function.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:02.56</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>to debug.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:13.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>duh... ok, i see. the existing code has memory pool for tree nodes if the nodes get deleted and reallocated. but fresh nodes are just allocated with posix_memalign() or calloc()...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:13.33</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah that should make them memory coherent. not.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:13.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well maybe if the malloc implementation is smart. which it usually isn't.</tt></td></tr>
<tr><td><tt>16:15.19</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad Caterpillar2 (~caterpill@unaffiliated/caterpillar)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:15.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yes... the results of changing this code should prove quite interesting.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:16.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>notice how my code which always evaluates the entire expression actually was either the same speed or faster in the simpler expressions.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:17.00</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>i hope so!</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:17.55</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>one thing that i noticed the other day was that the max rpn tree lenght in the havoc scene was 583 IIRC</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:19.16</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah that doesn't seem so good.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:19.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well you know there are several possible strategies to optimize the tree evaluator.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:21.47</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>say a solid is never intersected by any ray. so why evaluate that for every partition or whatever?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:22.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it's possible to optimize the tree in runtime or prior to render.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:22.49</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>A linear blob with small offsets rathre than pointers, all packed in memory, will definitely be faster on the CPU</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:23.33</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>And you can use something like a 3D space filling curve to sort data so it's spatially close, better filling cache lines. I remember getting a few extra percents from that</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:25.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah none of the buffers are in z-order. that likely has a negative impact.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:25.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i also need to reduce the amount of memory used in between stages.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:26.48</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>If you ever want some pretty fast space filling curve code: <a href="http://www.rayforce.net/ccspacecurve.c">http://www.rayforce.net/ccspacecurve.c</a>&nbsp;&nbsp;<a href="http://www.rayforce.net/ccspacecurve.h">http://www.rayforce.net/ccspacecurve.h</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:27.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>about using SoA vs AoS...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:28.07</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>once the code is cleaned up we might try that.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:28.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but right now i'm more concerned about thread divergence and poor usage of capacity.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:28.47</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Yup, that's really something for the final touch</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:28.57</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>(I gained 2-3% with that, woohoo)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:29.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i had like order of magnitude improvements once because full GPU units weren't being used because of divergence.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:30.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>that one can really bite.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:30.42</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Instead of testing 32 rays against a single sector or primitive, have you considered one warp testing one ray against 32 sectors or primitives?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:30.58</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>For highly incoherent rays, that seems like a better idea than trying to make coherent non-diverging bundles</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:31.27</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>(replace the 32 with 4 or 8 on CPUs, 64 on AMD, etc.)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:32.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well right now the code only does primaries. well it's generic enough to be used with any rays, but those are the only rays the generator generates.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:32.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i've had a lot of luck with sorting rays to decrease divergence.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:33.19</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Really?... Sorting rays either eat through your global memory banwidth, or you can't sort enough in on-chip shared memory</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:33.37</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>For me, it was always faster to just trace incoherently than to bother sorting them</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:33.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>in my own engine i actually fudged the RNG for the ambient occlusion rays so that those are more coherent. but don't tell anyone that... :-)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:33.55</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>But that could change if the acceleration structure was designed to test one ray against 32 primitives, instead of the other way around</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:34.06</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Eh, I did the same thing</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:34.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ahah</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:35.02</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well the sorting is useful if you have a fast sort.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:35.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>did you try using the CUB sort?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:35.20</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>The problem wasn't the fast sort, the problem was the global memory banwdith</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:35.28</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh that?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:35.33</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>I could trace incoherent rays for the same amount of bandwidth as sorting them</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:35.34</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you use compress-sort-decompress.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:36.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>have you read this paper?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:36.30</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="http://www.keldysh.ru/pages/cgraph/articles/dep20/publ2010/GPU-RayTracing.pdf">http://www.keldysh.ru/pages/cgraph/articles/dep20/publ2010/GPU-RayTracing.pdf</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:36.32</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Assuming rays bouncing everywhere, how do you compress the origin, vector and other contextual information about that ray's purpose?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:36.51</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>look at that paper. :-)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:37.29</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>The "compression" is for the sort, sure</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:37.52</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>But the write,read,write,read for bundling rays takes a lot of bandwidth</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:39.44</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Considering the typical incoherent ray for me had to touch about ~17 cache lines of 32 bytes...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:39.51</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>(if I remember the metric correctly)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:40.17</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>hm</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:40.21</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well you know</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:40.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>for my own render pipeline i only use that for incoherent rays.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:41.19</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>also i think it's not just a problem of memory coherence but of scheduling as well</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:41.38</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>like, adjacent rays typically have similar complexity.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:42.12</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Right, less waste from threads having nothing to do</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:42.43</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Well, like I said, if I had to trace a ton of incoherent rays again, I would just use a different acceleration structure</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:42.52</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Test a single ray against batches of 32 triangles instead</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:46.21</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i once read a poster by Yoon. he basically ran all the intersections against simplified geometry (like a convex hull of the geometry) to get an estimate for the hit points.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:46.34</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>sorted those in z-order. and then used that to schedule the rays.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:46.52</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it was an out-of-core renderer. so it made even more sense there.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:47.24</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>actually he used a simplified mesh, not the convex hull now that i think of it.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:48.04</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the ray against triangles... well.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:48.14</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the thing is... triangles are "fatter" than rays.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:49.08</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>But it's a lot easier to make coherent bundles of 32 triangles than 32 rays ;)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:49.25</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>(assuming global illumination-like incoherent tracing)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:49.45</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>3 vertexes with 3 coordinates of 4 bytes vs 2 vertexes with 3 coordinates.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:49.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and that's not even assuming the rays have same origin.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:50.32</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Rays also need to track contextual information, so you can accumulate back to whatever bounce it came from</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:50.55</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>sure an id can take care of that.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:50.58</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>(assuming you short and shuffle them)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:51.02</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>sort*</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:51.57</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>I don't know, there's a lot of potential for an acceleration structure designed to minimize the count of bundles of 32 triangles being tested (in the global cost function, 1 triangle in a sector has the same cost as 32)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:53.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i think i mentioned this in some slides for a class i gave sometime.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:53.43</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i was showing how you can reduce the amount of math ops in the intersections when testing with same ray origin vs same triangles and the like.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:54.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i remember that was also less nice for the many triangle approach.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:54.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>thing is, when the many rays don't have the same origin though, then it changes.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:55.15</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Right sure, highly coherent rays (including with same origin) is a different problem with a different optimal solution</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:57.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://drive.google.com/file/d/0B85Rkmt7rnCTWGVNUlhaZzZyQkU/view?usp=sharing">https://drive.google.com/file/d/0B85Rkmt7rnCTWGVNUlhaZzZyQkU/view?usp=sharing</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:57.40</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ aula.pdf - Google Drive ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:57.55</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>page 6.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:58.02</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i gave that class like 5 years ago.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:58.59</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i remember i analyzed that as i thought it was interesting. and ran some tests. then i gave it up. :-)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:59.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh... what was that other thing...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:59.38</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>right.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:59.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ray-triangle fan and ray-triangle strip optimized intersection routines.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:59.59</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i was looking at those back then too.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:00.34</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i only found like one decent paper for each one.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:00.58</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it's another way to reduce the bandwidth required for the triangles right?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:03.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so i looked at this one: <a href="http://gamma.cs.unc.edu/RS/paper_rt07.pdf">http://gamma.cs.unc.edu/RS/paper_rt07.pdf</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:03.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but i dunno it seemed kinda lame to me, that you needed to build a BSP</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:04.32</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>actually an skd-tree but whatever.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:05.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it seemed lame to me. to use axis aligned separators.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:05.44</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you already have the planes defined by the triangles or whatever.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:06.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so i also ignored that idea.</tt></td></tr>
<tr><td><tt>17:06.09</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad ``Erik (~erik@pool-100-16-14-17.bltmmd.fios.verizon.net)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:11.07</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>there's all sorts of tricks you can ues.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:11.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>use.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:11.41</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>like... you know how they say for primary rays since the origin is always the same, only store the direction? well i only stored the index used to generate the ray.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:11.58</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>then i have generator functions for rays. primaries, shadows, ambient occlusion the works.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:12.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so the engine was all specialized.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:13.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ah whatever. i'm not gonna pick that up again.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:13.50</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i've decided if i ever rewrite it, i'm gonna do everything differently.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:14.43</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so Stragus, are many-triangle intersections in fashion again?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:17.43</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>I have no idea what's in fashion. I almost never read papers, I just have fun ;)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:18.11</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>every once in a while something comes out that makes a difference. that's why i read papers.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:18.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>its usually not a new idea, but, the twist makes the difference.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:18.39</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>And really, I would recommend using a graph rather than a tree</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:18.49</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>for the geometry right?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:18.52</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>A tree implies a stack, which implies per-thread stores and loads, and that's terrible</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:19.00</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>For the space partitioning, yes</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:19.50</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>isn't that like a tree with ropes like they usually call it? well at least that's how Havran calls it.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:20.19</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>No idea if there's a fancy term for it. But what I use is a graph, sectors connecting to other sectors, there's no tree</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:20.56</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>then how's the partitioning done? does it still use split planes somehow?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:21.03</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>The idea being to avoid all per-thread memory stores, until you have your intersection point and you need to do something with it</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:21.44</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>I use axis-aligned sectors, which can overlap in space, and each facet of a sector can either connect to another sector or a "node" with a splitting plane to decide where to go next</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:22.13</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>There are other ways, that's not ideal for the one-ray-against-many-triangles approach</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:22.25</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>But just avoid a per-thread stack, no matter how you do it</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:22.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i've read something similar in papers from the 1980s but i can't say i remember other people working on that. it seemed like a cool idea when i read it.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:23.30</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>back then a lot of people were trying to get ray tracing to scale in MPP architectures.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:24.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>like Transputers or that Intel machine... the one with i860s.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:24.21</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Tracking a stack in L1 on many-cores no-SIMD chips is no big deal</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:24.35</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>But the situation is different with GPUs and modern wide SIMD</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:24.45</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://en.wikipedia.org/wiki/Intel_iPSC#iPSC.2F860">https://en.wikipedia.org/wiki/Intel_iPSC#iPSC.2F860</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:24.46</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ Intel iPSC - Wikipedia ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:25.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the Intel Paragon.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:25.45</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>maan... they spent a lot of time trying to minimize inter thread communications and ops.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:26.24</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well i dunno if those processors actually had caches.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:26.26</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Usually, for massively parallel software, you just write code to _avoid_ requiring low latency inter-thread/device communication</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:27.14</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>Like for computational fluid dynamics, it's better to compute the same cells redundantely while you receive results from other devices from two time steps ago</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:27.27</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ah right. the i860 had caches but early Transputers did not.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:28.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ah CFD. i always wondered how they implemented the data structures for the multi-grid solvers with AMR in those.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ever seen this?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://www.youtube.com/watch?v=vYA0f6R5KAI">https://www.youtube.com/watch?v=vYA0f6R5KAI</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.03</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ GPUs to Mars: Full-Scale Simulation of SpaceX's Mars Rocket Engine - YouTube ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.03</tt></td><td><font color="#65c065"><tt>Stragus</tt></font></td><td width="100%"><tt>AMR?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>Adaptive Mesh Refinement</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.34</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://en.wikipedia.org/wiki/Adaptive_mesh_refinement">https://en.wikipedia.org/wiki/Adaptive_mesh_refinement</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:29.34</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ Adaptive mesh refinement - Wikipedia ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:32.29</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://youtu.be/vYA0f6R5KAI?t=1510">https://youtu.be/vYA0f6R5KAI?t=1510</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:32.31</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ GPUs to Mars: Full-Scale Simulation of SpaceX's Mars Rocket Engine - YouTube ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:32.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>animated</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>17:33.14</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><font color="#CC00CC">is fascinated with grids.</font></tt></td></tr>
<tr><td><tt>17:38.53</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK_ (~Kim__@2600:8803:7a81:7400:c482:d704:f9cf:4675)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:33.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>mdtwenty[m], the code changes you made to branches/opencl seem to be fine at a glance.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:40.24</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD Wiki:Mariomeissner * 10157 /wiki/User:Mariomeissner/logs: </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:40.34</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>I noticed that some code from my previous patches still had indentation issues, so I fixed that and used it to make my first commit, like a test commit :)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:41.40</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>the code to skip unevaluated partitions should be okay, I did some testing and it iterates only over the evaluated partitions, although that didn't make that much of a difference in performance</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:43.36</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i remembered now that it might also be possible to reuse the forward_pp in the partitions, so next_evalpp might not be necessary.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:44.31</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>in rt_boolfinal.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:45.11</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you just need to cache the partitions[current_index].forw_pp in a variable, which could be named next_index, before writing over the value.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:45.43</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and then in the loop you get the next index from that cached variable instead of from the partition</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:47.39</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it should only make a difference in scenes with a lot of depth complexity.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:47.52</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>maybe in golliath it makes a difference?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:49.35</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>hm it has almost the same, but to be fair I only tested with the view az:35 el:25</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:50.02</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>front view could have a more noticeable difference</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:51.19</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>and I think that it is possible to discard the use of next_evalpp now that you mention it</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:52.08</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>and maybe we dont even need to cache the forw_pp, since I could only update the forw_pp of the last partition evaluated</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:52.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if we can reuse the foward_pp it would save memory in the partitions.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:53.25</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well you need to save it before you override it, because otherwise when the for (;;) loop iterates the value won't be correct.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:54.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>uint next_index;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:54.26</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>for (uint current_index = head; current_index != UINT_MAX; current_index = next_index) {</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:54.35</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:54.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:55.15</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:55.20</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh i see what you mean.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:55.30</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah it should be no problem.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:56.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>no need for the variable even.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>18:57.50</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>yeah :) I will update it</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:04.06</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i was also looking at if it was possible to remove the back_pp index by caching the previous index in a variable wherever that is used.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:04.28</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>a lot of times algorithms with double-linked lists aren't actually necessary.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:04.49</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>IIRC back_pp was only used in 1 condition in boolweave</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:05.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>its used in boolweave and rt_defoverlap</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:07.14</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>oh yes, right</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:07.50</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>but I think that could be cached in a variable</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:11.16</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i'm not so sure about that..</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:11.24</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the boolweave case sure.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:11.30</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but i'm not certain about defoverlap.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:12.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>because it doesn't iterate the list using the pointers</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:12.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it uses the ids</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:12.38</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>hm</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:12.43</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yes it might also be possible</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:13.13</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>by passing it the index to the previous partition via default_multioverlap in boolfinal</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:14.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so that would shave off like 8 bytes in each partition with these two modifications.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:14.42</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i also have an idea to shave off like half the memory used in the struct hits in the partitions so.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:15.08</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>over half actually</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:15.22</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so the struct partition should become less than half the size.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:20.12</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it seems like soon enough we'll have a our first generation system.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:21.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the only thing which might make things slower is the bitvectors. or not.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:21.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it think it will depend on how sparse the bitvectors are.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:21.51</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i suspect they'll be faster on average than if we used lists.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:22.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it also makes memory management easier.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:22.41</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh right, nearly forgot</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:23.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we're gonna need to make an array with uints, one uint per solid, where the uint has the id of the first region.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:23.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so i can shade the materials in single-hit mode properly.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:23.40</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>its only necessary in single-hit mode.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>you prolly noticed its shading everything white/gray in single-hit mode right now.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.25</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>and i can't remember anything else.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.38</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but there's plenty of optimizations we can do afterwards.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.50</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>yeah I noticed it, when it wasn't white/gray was every solid it the same color</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.52</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>03BRL-CAD:n_reed * 70035 brlcad/trunk/src/tclscripts/checker/CMakeLists.txt: Add initial check command test script.Currently runs the check Tcl-command in mged (mged -a nu -c) to checkbasic invocation behavior, and also subtraction behavior on two simpleoverlap cases.No args, but finds check.tcl by CHECKER_DIR environment variable.Doesn't run check.sh. Test databases and overlap directories are writtenout by the</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.54</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>test script itself.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.55</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh, right, i also need to fix the lights.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:24.56</tt></td><td><font color="#a25555"><tt>Notify</tt></font></td><td width="100%"><tt>...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:28.23</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>did you ever tried to render the havoc scene with your workstation GPU? I was curious about what the difference in time&nbsp;&nbsp;would be</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:29.06</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>it's bad... </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:29.14</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>there's too many roundtrips.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:29.32</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>those can be fixed, but it requires a reduce algorithm.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:29.42</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i think its better not to focus too much on that right now.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:29.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>we can just focus on the CPU performance.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:30.11</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i can later give you a piece of code with reduce for you to try out the difference.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:30.30</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>but the license might not be compatible for wider distribution.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:30.41</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>let's see...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:30.53</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>yeah i got that here.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:32.10</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ah we don't use the reduce, prolly just scan.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:32.37</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the reduce is a sum, and the scan is prefix sums.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:32.47</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt><a href="https://en.wikipedia.org/wiki/Prefix_sum">https://en.wikipedia.org/wiki/Prefix_sum</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:32.48</tt></td><td><font color="#64be64"><tt>i5o</tt></font></td><td width="100%"><tt>[ Prefix sum - Wikipedia ]</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:34.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>so we can compute the offsets quickly on the GPU side without doing memory transfers.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.00</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>i.e. this code:</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>BU_ASSERT((counts[i-1] % 2) == 0);</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.01</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>h[i] = h[i-1] + counts[i-1]/2;/* number of segs is half the number of hits */</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.03</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>if (counts[i-1]/2 &gt; max_depth)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.05</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.07</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.09</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>in clt_Frame()</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.46</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>oh... except it does two things it computes the max and it does the prefix sums.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:36.58</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>the max_depth is a sort of reduce i guess.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:40.05</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>well enough of that</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:40.42</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>keep me notified of your progress on the ANSI C bool_eval() then mdtwenty[m]. i'll see if can work on the lights this week.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:41.23</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>&lt;PROTECTED&gt;</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:41.38</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>Yeah I will update you as soon as I have some progress</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:41.51</tt></td><td><font color="#bc63bc"><tt>vasc</tt></font></td><td width="100%"><tt>ok see you later!</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:42.08</tt></td><td><font color="#bd6363"><tt>mdtwenty[m]</tt></font></td><td width="100%"><tt>see you later!</tt></td></tr>
<tr><td><tt>19:44.09</tt></td><td colspan=2><tt><font color="#000099">*** part/#brlcad mdtwenty[m] (mdtwentyma@gateway/shell/matrix.org/x-zzjodrxmmmvwtbhh)</font></tt></td></tr>
<tr><td><tt>19:59.45</tt></td><td colspan=2><tt><font color="#000099">*** part/#brlcad mdtwenty (bc519789@gateway/web/freenode/ip.188.81.151.137)</font></tt></td></tr>
<tr><td><tt>20:05.54</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad mdtwenty[m] (mdtwentyma@gateway/shell/matrix.org/x-zzjodrxmmmvwtbhh)</font></tt></td></tr>
<tr><td><tt>20:15.04</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad yukonbob (~bch@S0106c8fb2656f971.ok.shawcable.net)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>20:15.09</tt></td><td><font color="#b2b25e"><tt>yukonbob</tt></font></td><td width="100%"><tt>hello #brlcad</tt></td></tr>
<tr><td><tt>22:10.05</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad yukonbob (~bch@S0106c8fb2656f971.ok.shawcable.net)</font></tt></td></tr>
</table>

<br>Generated by irclog2html.pl
Modified by <a href="http://Rikers.org">Tim Riker</a> to work with
<a href="http://infobot.sourceforge.net/">infobot</a>.
</body></html>
