<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0" />
<title>irclog2html for #brlcad on 20050911</title>
<meta name="generator" content="irclog2html.pl by Jeff Waugh" />
<meta name="version" content="Version 1.5 - 11th May 2000" />
<meta http-equiv="Content-Type" content=
"text/html; charset=utf-8" />
<style type="text/css">
/*<![CDATA[*/
 body {
  background-color: #FFFFFF;
  color: #000000;
 }
 span.c5 {color: #6AC96A}
 span.c4 {color: #009900}
 span.c3 {color: #B760B7}
 tr.c2 {background-color: #EEEEEE}
 span.c1 {color: #5CAE5C}
/*]]>*/
</style>
</head>
<body>
<h1>irclog2html for #brlcad on 20050911</h1>
<table cellspacing="3" cellpadding="2" border="0">
<tr class="c2">
<td><tt>03:27.41</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>That's strange, what kind of threading problem
was it?</tt></td>
</tr>
<tr class="c2">
<td><tt>04:11.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>play yoot's tower?</tt></td>
</tr>
<tr class="c2">
<td><tt>04:30.33</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Not yet still, some AD&amp;D game consumed
most of the day, I soon will</tt></td>
</tr>
<tr class="c2">
<td><tt>04:30.57</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>heh</tt></td>
</tr>
<tr class="c2">
<td><tt>04:31.29</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yoot's seems to be a bit more challenging than
the previous one, the locality of offices seems to be more
sensitive to traffic and noise</tt></td>
</tr>
<tr class="c2">
<td><tt>04:32.24</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Excellent, Sim Tower was way too
easy</tt></td>
</tr>
<tr class="c2">
<td><tt>04:32.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yah</tt></td>
</tr>
<tr class="c2">
<td><tt>04:32.52</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>easy and loooong</tt></td>
</tr>
<tr class="c2">
<td><tt>04:33.01</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>took forever to finish when I was playing it
on my P133</tt></td>
</tr>
<tr class="c2">
<td><tt>04:33.06</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>back in '95</tt></td>
</tr>
<tr class="c2">
<td><tt>04:33.25</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Ahah. It didn't take too long on the dual-mp,
time was flying way too fast even in non-fast mode</tt></td>
</tr>
<tr class="c2">
<td><tt>04:33.31</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Faster than I could spend anyway</tt></td>
</tr>
<tr class="c2">
<td><tt>04:33.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>heh, that certainly makes it quick</tt></td>
</tr>
<tr>
<td><tt>05:42.29</tt></td>
<td colspan="2"><tt><span class="c4">*** join/#brlcad Erroneous
(n=DTRemena@DHCP-170-143.caltech.edu)</span></tt></td>
</tr>
<tr>
<td><tt>05:44.24</tt></td>
<td colspan="2"><tt><span class="c4">*** join/#brlcad Erroneous
(n=DTRemena@DHCP-170-143.caltech.edu)</span></tt></td>
</tr>
<tr class="c2">
<td><tt>05:44.28</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>o.O</tt></td>
</tr>
<tr>
<td><tt>14:21.25</tt></td>
<td colspan="2"><tt><span class="c4">*** join/#brlcad docelic
(n=docelic@ri01-150.dialin.iskon.hr)</span></tt></td>
</tr>
<tr class="c2">
<td><tt>16:16.08</tt></td>
<td><span class="c5"><tt>silvap_</tt></span></td>
<td width="100%"><tt>yoot's tower came b4 sim tower, no?</tt></td>
</tr>
<tr class="c2">
<td><tt>18:30.25</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>after</tt></td>
</tr>
<tr class="c2">
<td><tt>18:40.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>wow, I've got a little test app here that
shows how sucky performance is when multiple threads reading from
the same buffer</tt></td>
</tr>
<tr class="c2">
<td><tt>18:40.53</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Of course, the processors keep trashing each
other's cache</tt></td>
</tr>
<tr class="c2">
<td><tt>18:40.59</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yah :|</tt></td>
</tr>
<tr class="c2">
<td><tt>18:41.10</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but this is a 64 byte array</tt></td>
</tr>
<tr class="c2">
<td><tt>18:41.17</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it should always live in cache o.O</tt></td>
</tr>
<tr class="c2">
<td><tt>18:42.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>that explains why my ray-tracer with 4 threads
performans at half the speed as 4 separate instances</tt></td>
</tr>
<tr class="c2">
<td><tt>18:42.49</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm getting same results on linux,bsd
(xeon,opteron)</tt></td>
</tr>
<tr class="c2">
<td><tt>18:42.51</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>If it was up to the programmer to deal with
coherency of the caches, we really could scale motherboards to
large amount of processors</tt></td>
</tr>
<tr class="c2">
<td><tt>18:43.02</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Ah I see</tt></td>
</tr>
<tr class="c2">
<td><tt>18:43.03</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>that's not the problem</tt></td>
</tr>
<tr class="c2">
<td><tt>18:43.09</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it's the memory</tt></td>
</tr>
<tr class="c2">
<td><tt>18:43.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>my stryker model sucks up 1.3GB of memory when
fully loaded</tt></td>
</tr>
<tr class="c2">
<td><tt>18:43.40</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and unless I have 2GB of ram per cpu on the
mobo a bajillion processors doesn't make it any better</tt></td>
</tr>
<tr class="c2">
<td><tt>18:44.05</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>which is why I got this opteron machine with
8GB of ram per box</tt></td>
</tr>
<tr class="c2">
<td><tt>18:44.12</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so I could have (4) 2GB instances
going</tt></td>
</tr>
<tr class="c2">
<td><tt>18:44.34</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>which is why I'm seeing performance
soar</tt></td>
</tr>
<tr class="c2">
<td><tt>18:45.00</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I mean this one opteron machine with 4
instances is out performing the entire cluster cause each node only
has 2GB</tt></td>
</tr>
<tr class="c2">
<td><tt>18:45.16</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Ahah</tt></td>
</tr>
<tr class="c2">
<td><tt>18:45.40</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>now if each node has 4GB of ram (prohibitively
expensive at the team, each node has 6 ram slots)</tt></td>
</tr>
<tr class="c2">
<td><tt>18:45.50</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>then I'd be seing twice the performance out of
each one</tt></td>
</tr>
<tr class="c2">
<td><tt>18:46.11</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>based on these findings I'm half tempted to
rip all of the threading code out</tt></td>
</tr>
<tr class="c2">
<td><tt>18:46.22</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I don't see the problem with multiple
threads|processors sharing the same banks, although Opterons do
have per-processor banks with faster access</tt></td>
</tr>
<tr class="c2">
<td><tt>18:46.26</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>cause my application is omfg fast and
cache-coherent</tt></td>
</tr>
<tr class="c2">
<td><tt>18:46.33</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it's not benefiting from threads hardly at
all</tt></td>
</tr>
<tr class="c2">
<td><tt>18:46.49</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>are you getting linear speed-ups with
threading?</tt></td>
</tr>
<tr class="c2">
<td><tt>18:46.55</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>You have to garantee processors won't be
stepping on each other's feet, regarding read and write to their
cache</tt></td>
</tr>
<tr class="c2">
<td><tt>18:47.18</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I... have no idea, I haven't even tested on
the dual-mp</tt></td>
</tr>
<tr class="c2">
<td><tt>18:47.22</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>ah</tt></td>
</tr>
<tr class="c2">
<td><tt>18:47.36</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>you got a demo with dynamic number of threads
I can specify with no graphics output handy?</tt></td>
</tr>
<tr class="c2">
<td><tt>18:47.41</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>just the text?</tt></td>
</tr>
<tr class="c2">
<td><tt>18:47.57</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Hum, give me 2 minutes</tt></td>
</tr>
<tr class="c2">
<td><tt>18:47.59</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>btw, when you ship another demo</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.10</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>make the fps output a:</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.18</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>printf("fps: %d\r", fps);</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>fflush(stdout);</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.24</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I'm deep into rewriting large chunks of the
scene prep, it might take a bit</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.32</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>that's what cvs is for :)</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.40</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so you can checkout an older stable
version</tt></td>
</tr>
<tr class="c2">
<td><tt>18:48.40</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>So noted, fbsd doesn't naturally flush on
\n</tt></td>
</tr>
<tr class="c2">
<td><tt>18:49.05</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>use cvs damnit :)</tt></td>
</tr>
<tr class="c2">
<td><tt>18:49.42</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>ugh</tt></td>
</tr>
<tr class="c2">
<td><tt>18:49.43</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Yes, maybe I should :)</tt></td>
</tr>
<tr class="c2">
<td><tt>18:50.05</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>It's for historical purposes, back to the
castle days and our 300k rays per second</tt></td>
</tr>
<tr class="c2">
<td><tt>18:50.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>you should shove those into cvs in sequential
order</tt></td>
</tr>
<tr class="c2">
<td><tt>18:51.58</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm boggled is doesn't shove this 64 byte
array in cache</tt></td>
</tr>
<tr class="c2">
<td><tt>18:52.05</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>It's got a friggen 1MB of cache</tt></td>
</tr>
<tr class="c2">
<td><tt>18:55.18</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>heh</tt></td>
</tr>
<tr class="c2">
<td><tt>18:55.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm causing system time to spike and user/wall
time just plop along</tt></td>
</tr>
<tr class="c2">
<td><tt>18:56.39</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I quickly modified the latest backup to use
the first argument as number of threads</tt></td>
</tr>
<tr class="c2">
<td><tt>18:56.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k</tt></td>
</tr>
<tr class="c2">
<td><tt>18:56.56</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'll benchmark on my opteron</tt></td>
</tr>
<tr class="c2">
<td><tt>18:57.06</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>if I have linux abi going</tt></td>
</tr>
<tr class="c2">
<td><tt>18:57.12</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Running on 64 bits of course?</tt></td>
</tr>
<tr class="c2">
<td><tt>18:57.17</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>let me see</tt></td>
</tr>
<tr class="c2">
<td><tt>18:57.28</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yah</tt></td>
</tr>
<tr class="c2">
<td><tt>18:57.35</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>*should* work</tt></td>
</tr>
<tr class="c2">
<td><tt>18:57.57</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>All right, that's an ELF 64-bit LSB
executable, AMD x86-64</tt></td>
</tr>
<tr class="c2">
<td><tt>18:59.05</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>ELF binary type "0" not known.</tt></td>
</tr>
<tr class="c2">
<td><tt>18:59.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>*shrug*</tt></td>
</tr>
<tr class="c2">
<td><tt>18:59.29</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>guess it's not bsd friendly</tt></td>
</tr>
<tr class="c2">
<td><tt>18:59.53</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>for me here's how I do on threading</tt></td>
</tr>
<tr class="c2">
<td><tt>19:00.11</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>compared to 100% performance on four separate
threads</tt></td>
</tr>
<tr class="c2">
<td><tt>19:00.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>1: 25%, 2: 15%, 3: 10%, 4: 5%</tt></td>
</tr>
<tr class="c2">
<td><tt>19:00.34</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>in terms of performance gains</tt></td>
</tr>
<tr class="c2">
<td><tt>19:00.52</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so the 5 threaded version is 50 - 55% of 4
separate threads</tt></td>
</tr>
<tr class="c2">
<td><tt>19:00.58</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and the 4th thread buys you almost
nothing</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.12</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so you really need 4 cpus</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>cause you'll probly see a nearly 2x
performance gain with 2 threaded version</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.38</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so it won't tell you much</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.40</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>That's for dual-xeons?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.43</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>opteron</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.49</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>2core dual cpu</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.53</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Ah yes, dual core</tt></td>
</tr>
<tr class="c2">
<td><tt>19:01.58</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and xeon is slightly worse</tt></td>
</tr>
<tr class="c2">
<td><tt>19:02.04</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but more or less the same</tt></td>
</tr>
<tr class="c2">
<td><tt>19:02.26</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Do each of your threads work on fairly
distinct chunks of memory?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:02.43</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>they get a *chunk* of pixels to work on that
are coherent</tt></td>
</tr>
<tr class="c2">
<td><tt>19:02.44</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Especially the write operations, they must not
trash the other processors cache</tt></td>
</tr>
<tr class="c2">
<td><tt>19:02.51</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>the writes are to distinct memory</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.04</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>the reads are probly from common memory most
of the time, (the triangle data)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.05</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>No problem there, I suppose the chunks are big
enough</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.08</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>cause the rays are coherent</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.24</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so for 128x128 pixels</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.33</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>4 threads will take on 128 pixel scan lines
for now</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.39</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>128x128 goes across the network</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.48</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and 4 threads gobble up a 128 pixel scanline
at a time</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.54</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>(all configurable in the environment file for
the project)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:03.59</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Could it be a problem of synchronisation,
mutexes and network I/O ?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:04.02</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>this is is an example, nothing is
hard-wired</tt></td>
</tr>
<tr class="c2">
<td><tt>19:04.22</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I don't think so, cause I got a demo here that
doesn't do any network i/o</tt></td>
</tr>
<tr class="c2">
<td><tt>19:04.36</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I suppose the count of mutexes is very low
too</tt></td>
</tr>
<tr class="c2">
<td><tt>19:04.39</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and the only thing a mutex is doing is locking
to increment a variable (i++) then unlocking</tt></td>
</tr>
<tr class="c2">
<td><tt>19:04.52</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and after each mutex it does millions of
computations</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.00</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so mutex should be neglidgible</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.05</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yes</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.11</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>mutex locking is in the 10's or
100's</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.16</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>computations in the loop are in the
millions</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.18</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Is this variable shared by all threads? How
often does it increment?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.26</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Ah.</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.27</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>10 to 100 times</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.34</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it represents work units</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.40</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>work unit index rather</tt></td>
</tr>
<tr class="c2">
<td><tt>19:05.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I am working on work unit 'i'</tt></td>
</tr>
<tr class="c2">
<td><tt>19:06.27</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>an the 'work' is a float[16] array, where it
does a random read from it (as happens in triangle ray-tracing from
big triangle array) and does math on the value at
float[...]</tt></td>
</tr>
<tr class="c2">
<td><tt>19:06.29</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>now</tt></td>
</tr>
<tr class="c2">
<td><tt>19:06.44</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>if I put a = array[rand....] in the
loop</tt></td>
</tr>
<tr class="c2">
<td><tt>19:06.55</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>where it goes done millions of time,
performance is horrible nasty omfg slow</tt></td>
</tr>
<tr class="c2">
<td><tt>19:07.04</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>if I put it before the loop so it only gets
called a few hundred times</tt></td>
</tr>
<tr class="c2">
<td><tt>19:07.11</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>then performance is parallel</tt></td>
</tr>
<tr class="c2">
<td><tt>19:07.16</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>more threads = more cpu</tt></td>
</tr>
<tr class="c2">
<td><tt>19:07.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>which is why for ray-tracing</tt></td>
</tr>
<tr class="c2">
<td><tt>19:07.24</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it's reall a mix of both</tt></td>
</tr>
<tr class="c2">
<td><tt>19:07.38</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>which is why we get 'some' performance, but it
ramps down rather quickly</tt></td>
</tr>
<tr class="c2">
<td><tt>19:08.10</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Yes I get the picture</tt></td>
</tr>
<tr class="c2">
<td><tt>19:08.26</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so I'm curious if it's just me</tt></td>
</tr>
<tr class="c2">
<td><tt>19:08.36</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>or if my conclusions are similiar in your
case</tt></td>
</tr>
<tr class="c2">
<td><tt>19:08.51</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Would you be able to run a 32 bits linux
binary?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:08.55</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I dunno</tt></td>
</tr>
<tr class="c2">
<td><tt>19:08.56</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>we could try</tt></td>
</tr>
<tr class="c2">
<td><tt>19:09.01</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I don't think the 'speed' matters</tt></td>
</tr>
<tr class="c2">
<td><tt>19:09.06</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>just the threaded relationship</tt></td>
</tr>
<tr class="c2">
<td><tt>19:09.25</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>in regards to performance</tt></td>
</tr>
<tr class="c2">
<td><tt>19:09.58</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Right</tt></td>
</tr>
<tr class="c2">
<td><tt>19:10.27</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I have been glancing over your code, I don't
really see a potential problem, yet</tt></td>
</tr>
<tr class="c2">
<td><tt>19:10.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>ah, in the engine?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:10.51</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>the camera in libutil/camera.c</tt></td>
</tr>
<tr class="c2">
<td><tt>19:10.54</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>is the threading</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.02</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>the engine tie.c is the intersection
code</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.12</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I know ;)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k :)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>when is the last time you updated?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.25</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I have been making changes left and
right</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.34</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>It might be up to a week old</tt></td>
</tr>
<tr class="c2">
<td><tt>19:11.37</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k</tt></td>
</tr>
<tr class="c2">
<td><tt>19:12.07</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Did you try the 32 bits binary?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:13.04</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>anyway to remove sdl quickly?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:13.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I don't think I have sdl installed for linux
on freebsd</tt></td>
</tr>
<tr class="c2">
<td><tt>19:13.17</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Oops.</tt></td>
</tr>
<tr class="c2">
<td><tt>19:13.24</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>A moment.</tt></td>
</tr>
<tr class="c2">
<td><tt>19:13.28</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k</tt></td>
</tr>
<tr class="c2">
<td><tt>19:13.39</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>looks like it should otherwise run
though</tt></td>
</tr>
<tr class="c2">
<td><tt>19:17.45</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>All right, download from same
address</tt></td>
</tr>
<tr class="c2">
<td><tt>19:19.07</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>your printf still pours out pages and pages of
numbers</tt></td>
</tr>
<tr class="c2">
<td><tt>19:19.08</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>and I forgot the fflush() :)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:19.12</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>heh</tt></td>
</tr>
<tr class="c2">
<td><tt>19:19.43</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>You can set the number of threads by the first
argument</tt></td>
</tr>
<tr class="c2">
<td><tt>19:19.49</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yep</tt></td>
</tr>
<tr class="c2">
<td><tt>19:20.20</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>can you do the fflush thing?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:20.35</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>don't think my terminal is keeping up to
speed</tt></td>
</tr>
<tr class="c2">
<td><tt>19:21.07</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Okay... Give me a moment to re-do all the SDL
removal :}</tt></td>
</tr>
<tr class="c2">
<td><tt>19:21.16</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>you just delete it?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:21.39</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>this is the part where you would've tagged a
branch in cvs for me ;)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:24.14</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>You know... There is already a  fflush( stdout
);  in there</tt></td>
</tr>
<tr class="c2">
<td><tt>19:24.31</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>using '\r' as the terminator?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:24.44</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>'\n' can't be there</tt></td>
</tr>
<tr class="c2">
<td><tt>19:24.53</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Oh?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:25.05</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>'\n' means new line</tt></td>
</tr>
<tr class="c2">
<td><tt>19:25.08</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>we don't want a new line</tt></td>
</tr>
<tr class="c2">
<td><tt>19:26.30</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Fine, download again</tt></td>
</tr>
<tr class="c2">
<td><tt>19:26.35</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k :)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:27.10</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>much better</tt></td>
</tr>
<tr class="c2">
<td><tt>19:27.32</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>1: 14 fps</tt></td>
</tr>
<tr class="c2">
<td><tt>19:28.00</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>2: 27 fps</tt></td>
</tr>
<tr class="c2">
<td><tt>19:28.29</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>3: 37 fps</tt></td>
</tr>
<tr class="c2">
<td><tt>19:28.54</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>4: 43 fps</tt></td>
</tr>
<tr class="c2">
<td><tt>19:29.26</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Four processors to run 3 times faster than
one, the loss is reasonable</tt></td>
</tr>
<tr class="c2">
<td><tt>19:29.38</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yah, it's pretty good I'd say</tt></td>
</tr>
<tr class="c2">
<td><tt>19:29.46</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>how are you threading?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:29.48</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>per scanline?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:29.57</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Per block of 32x32 pixels in what I sent
you</tt></td>
</tr>
<tr class="c2">
<td><tt>19:30.09</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>each thread works on a block?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:30.19</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Right, and fetch the next block pending in
queue once it's done</tt></td>
</tr>
<tr class="c2">
<td><tt>19:30.29</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k, that was my next step</tt></td>
</tr>
<tr class="c2">
<td><tt>19:30.39</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>for threading</tt></td>
</tr>
<tr class="c2">
<td><tt>19:30.47</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I think you want as little coherency as
possible between threads</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.04</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>otherwise you have threads doing reads from
the same memory segment it seems</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.08</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but that *should* be in cache</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.21</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Reads from the same segments aren't generally
a problem, not a big one anyway</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.22</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>a thread has no idea if that data is
current</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.27</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so I think in general it has to do a fresh
read</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.35</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>It doesn't trash the cache, it might just be a
bit of a bottleneck on a memory bank</tt></td>
</tr>
<tr class="c2">
<td><tt>19:31.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>right, but do you agree with my
statement?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:32.02</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I don't see what you mean by "data being
current"</tt></td>
</tr>
<tr class="c2">
<td><tt>19:32.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>thread 1 pulls from array[1234] at time
interval X</tt></td>
</tr>
<tr class="c2">
<td><tt>19:32.21</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>thread 2 pulls from array[1234] at time
interval Y</tt></td>
</tr>
<tr class="c2">
<td><tt>19:32.36</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>how does thread 2 know that array[1234] at
time interval Y read the same data as interval X</tt></td>
</tr>
<tr class="c2">
<td><tt>19:32.48</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I doesn't... so I think it cannot rely on
cache</tt></td>
</tr>
<tr class="c2">
<td><tt>19:33.03</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>If no other processor has modified the data,
it will remain in the processor's cache</tt></td>
</tr>
<tr class="c2">
<td><tt>19:33.26</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>okie</tt></td>
</tr>
<tr class="c2">
<td><tt>19:33.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>welp, let me try postage stamping the threaded
work units like I'm already doing for the distributed compute
nodes</tt></td>
</tr>
<tr class="c2">
<td><tt>19:34.08</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>(I've done this before in previous
experiments)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:34.25</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but I never tested improvement of linearity of
threads</tt></td>
</tr>
<tr class="c2">
<td><tt>19:34.43</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Mmhm, good luck.  Verify your writes
especially, I suspect something is trashing the caches
somewhere</tt></td>
</tr>
<tr class="c2">
<td><tt>19:35.04</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>possibly</tt></td>
</tr>
<tr class="c2">
<td><tt>19:35.26</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I generate a ray, I fire the ray, the ray gets
intersected against triangles, the result goes to the render
method, render method shades a pixel, pixel gets shoved into a
128x128x3 buffer</tt></td>
</tr>
<tr class="c2">
<td><tt>19:35.36</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Where do threads pull their ray vectors
from?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:35.47</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>each thread has an instance of a ray
object</tt></td>
</tr>
<tr class="c2">
<td><tt>19:38.13</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>according to your single threaded performance,
using your SSE stuff and optical bundle tricks you seem to be 7x
faster than mine</tt></td>
</tr>
<tr class="c2">
<td><tt>19:39.13</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>for non-coherent path tracing stuff I think
you're 1.5 - 2.0x faster</tt></td>
</tr>
<tr class="c2">
<td><tt>19:39.26</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>:) Not too bad, but the new scene
analysis/preparation is still in the workshop</tt></td>
</tr>
<tr class="c2">
<td><tt>19:39.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but you don't have rays all the way through or
doubled sided normals on</tt></td>
</tr>
<tr class="c2">
<td><tt>19:39.34</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>k</tt></td>
</tr>
<tr class="c2">
<td><tt>19:39.58</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I've got a potential 15% performance
improvement for optical rendering only I might drop in
tonight</tt></td>
</tr>
<tr class="c2">
<td><tt>19:40.24</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>that should inch me towards 2
mil/sec</tt></td>
</tr>
<tr class="c2">
<td><tt>19:40.40</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>for certain views, but on average about 1.5
mil/sec I think</tt></td>
</tr>
<tr class="c2">
<td><tt>19:40.53</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I went to implement rays going through
geometry with callbacks a few days ago, but it looked really messy
to implement in the SSE path working in bundles</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.14</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yes</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.21</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>now you see why I haven't done it
yet</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>or anyone has</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.38</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I may well just support that for single rays,
which is trivial, for now anyway</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.42</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>yah</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.47</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>btw</tt></td>
</tr>
<tr class="c2">
<td><tt>19:41.52</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm thinking about removing
callbacks</tt></td>
</tr>
<tr class="c2">
<td><tt>19:42.02</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and just putting the intersection stack into
the ray itself</tt></td>
</tr>
<tr class="c2">
<td><tt>19:42.13</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so if you fire a ray again with a used
stack</tt></td>
</tr>
<tr class="c2">
<td><tt>19:42.18</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it'll just resume using the stack</tt></td>
</tr>
<tr class="c2">
<td><tt>19:42.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>removes an extra function call for optical
rendering</tt></td>
</tr>
<tr class="c2">
<td><tt>19:42.34</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Will this ray be able to change
direction?</tt></td>
</tr>
<tr class="c2">
<td><tt>19:42.47</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>huh? of course you fire a new ray</tt></td>
</tr>
<tr class="c2">
<td><tt>19:43.07</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>a changed direction means generating a new ray
for me</tt></td>
</tr>
<tr class="c2">
<td><tt>19:43.27</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>So you could re-use the intersection point of
a ray, as a source for new rays, exploiting the locality of
rays</tt></td>
</tr>
<tr class="c2">
<td><tt>19:43.44</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>not with a tree</tt></td>
</tr>
<tr class="c2">
<td><tt>19:43.59</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>with a graph, sure</tt></td>
</tr>
<tr class="c2">
<td><tt>19:44.22</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>when I feel I've completely run out of
tricks</tt></td>
</tr>
<tr class="c2">
<td><tt>19:44.27</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I might try the graph approach</tt></td>
</tr>
<tr class="c2">
<td><tt>19:44.39</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>brb, gonna make a quick lunch</tt></td>
</tr>
<tr class="c2">
<td><tt>19:44.44</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I think a shortcut would be possible, but in
any case... yes, I believe a graph is much more appropriate
:)</tt></td>
</tr>
<tr class="c2">
<td><tt>19:44.53</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>for path tracing, definetly</tt></td>
</tr>
<tr class="c2">
<td><tt>19:45.17</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>but *ahem* lee wanted me to implement wald's
paper *ahem*</tt></td>
</tr>
<tr class="c2">
<td><tt>19:45.27</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so I have to roll with that for now</tt></td>
</tr>
<tr class="c2">
<td><tt>19:45.35</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>For any ray-tracing needs really, since a
graph can both exploit coherency and locality</tt></td>
</tr>
<tr class="c2">
<td><tt>19:45.47</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>jup</tt></td>
</tr>
<tr class="c2">
<td><tt>19:45.49</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>*nods* So I understood... Lee isn't here, is
he? :p</tt></td>
</tr>
<tr class="c2">
<td><tt>19:45.55</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>he's polyspin</tt></td>
</tr>
<tr class="c2">
<td><tt>19:46.08</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>brb, gonna make some lunch</tt></td>
</tr>
<tr class="c2">
<td><tt>20:04.26</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>back</tt></td>
</tr>
<tr class="c2">
<td><tt>20:05.58</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>If you are going to try a graph based
technique, I still think a tetrahedron graph could be
promising</tt></td>
</tr>
<tr class="c2">
<td><tt>20:06.13</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>No sectors, no nodes, no triangle, a single
primitive ; tetrahedrons</tt></td>
</tr>
<tr class="c2">
<td><tt>20:06.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>maybe we can work on this
together...</tt></td>
</tr>
<tr class="c2">
<td><tt>20:07.23</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>*nods* I still have a fairly long to-do list
on my current design</tt></td>
</tr>
<tr class="c2">
<td><tt>20:07.45</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm sure this will be some ongoing research
we'll be involved with for years to come</tt></td>
</tr>
<tr class="c2">
<td><tt>20:08.07</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>we'll probly be 30 or so before this winds
down</tt></td>
</tr>
<tr class="c2">
<td><tt>20:09.23</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Eheh, I wouldn't mind :), I haven't found a
field that led to so interesting, mind boggling problems just
waiting to be solved</tt></td>
</tr>
<tr class="c2">
<td><tt>20:09.46</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>another field, that is</tt></td>
</tr>
<tr class="c2">
<td><tt>20:10.46</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>the only other thing I found nearly this
interested was when I was working on my coil gun</tt></td>
</tr>
<tr class="c2">
<td><tt>20:11.18</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it was easy to see how years of research could
be speant optimizing the efficiency of the energy
transfer</tt></td>
</tr>
<tr class="c2">
<td><tt>20:12.15</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Eh I suppose, how did this project work
out?</tt></td>
</tr>
<tr class="c2">
<td><tt>20:12.42</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I was able to get my single stage coil gun up
to an efficiency of about 2% using off the shelf power supply
capacitors and hand-wound litz wire</tt></td>
</tr>
<tr class="c2">
<td><tt>20:12.54</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>max efficiency I've ever seen somone get out
of single stage is 10%</tt></td>
</tr>
<tr class="c2">
<td><tt>20:13.03</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>in research labs etc</tt></td>
</tr>
<tr class="c2">
<td><tt>20:13.03</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Hum :), I see</tt></td>
</tr>
<tr class="c2">
<td><tt>20:13.14</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>I have been thinking sporadically about AI
since my early genetic experiments too, that's something I want to
get back into, I have my ideas for a lower level approach to the
problem</tt></td>
</tr>
<tr class="c2">
<td><tt>20:13.32</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Much closer to the fundamental definition of
intelligence, nothing like faking it at high-level with neural
networks</tt></td>
</tr>
<tr class="c2">
<td><tt>20:16.59</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Any more clues on the threading performance
issue?</tt></td>
</tr>
<tr class="c2">
<td><tt>20:17.09</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm still playing with my demo</tt></td>
</tr>
<tr class="c2">
<td><tt>20:17.15</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>recreating a base-model of what's going
on</tt></td>
</tr>
<tr class="c2">
<td><tt>20:17.28</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and I'm seeing resonable performance from
it</tt></td>
</tr>
<tr class="c2">
<td><tt>20:17.30</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>near-linear</tt></td>
</tr>
<tr class="c2">
<td><tt>20:17.44</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>16384 random accesses to a 16MB array
distributed among 4 threads</tt></td>
</tr>
<tr class="c2">
<td><tt>20:17.52</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>doing a billion iteration computation
loop</tt></td>
</tr>
<tr class="c2">
<td><tt>20:18.13</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>each work unit is a random access</tt></td>
</tr>
<tr class="c2">
<td><tt>20:18.16</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Read operations can't be the source of such a
performance bottleneck</tt></td>
</tr>
<tr class="c2">
<td><tt>20:18.23</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>indeed</tt></td>
</tr>
<tr class="c2">
<td><tt>20:23.38</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>one thing you have to worry about with
opterons is the hyper transport too</tt></td>
</tr>
<tr class="c2">
<td><tt>20:23.59</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>it's a big bottle neck</tt></td>
</tr>
<tr class="c2">
<td><tt>20:27.11</tt></td>
<td><span class="c5"><tt>silvap_</tt></span></td>
<td width="100%"><tt>i swear i saw a reference to yoot saito's
"yoot's tower" in the sim tower splash screen</tt></td>
</tr>
<tr class="c2">
<td><tt>20:30.59</tt></td>
<td><span class="c5"><tt>silvap_</tt></span></td>
<td width="100%"><tt>Maloeran, what sorta AI stuff have u
done</tt></td>
</tr>
<tr class="c2">
<td><tt>20:32.14</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Long ago, genetic algorithms to build up an AI
for a primitive strategy game of some sort</tt></td>
</tr>
<tr class="c2">
<td><tt>20:32.40</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>It played for months against itself on a P3,
results were deceiving ( the learning pace was below my
expectations )</tt></td>
</tr>
<tr class="c2">
<td><tt>20:33.29</tt></td>
<td><span class="c5"><tt>silvap_</tt></span></td>
<td width="100%"><tt>hehe cool</tt></td>
</tr>
<tr class="c2">
<td><tt>20:34.13</tt></td>
<td><span class="c5"><tt>silvap_</tt></span></td>
<td width="100%"><tt>was it coupled with an ANN or was the state
space too large?</tt></td>
</tr>
<tr class="c2">
<td><tt>20:35.00</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>It wasn't, it really was a straight genetic
algorithm</tt></td>
</tr>
<tr class="c2">
<td><tt>20:35.21</tt></td>
<td><span class="c5"><tt>silvap_</tt></span></td>
<td width="100%"><tt>ah</tt></td>
</tr>
<tr class="c2">
<td><tt>20:35.35</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>i.e brute force :)</tt></td>
</tr>
<tr class="c2">
<td><tt>20:35.47</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>On a Pentium 3! :)</tt></td>
</tr>
<tr class="c2">
<td><tt>20:36.01</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>meh, that's not that long ago</tt></td>
</tr>
<tr class="c2">
<td><tt>20:36.09</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>now if it were a P133 ...</tt></td>
</tr>
<tr class="c2">
<td><tt>20:37.10</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Pentium 3 733mhz, running all nights on my
father's computer, it was high end back then</tt></td>
</tr>
<tr class="c2">
<td><tt>20:52.48</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>getting closer to the problem</tt></td>
</tr>
<tr class="c2">
<td><tt>20:53.09</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>just replaced my ray intersection with a loop
that does 1024 floating multiplies</tt></td>
</tr>
<tr class="c2">
<td><tt>20:53.26</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>100% 75% 25% 19% efficiency</tt></td>
</tr>
<tr class="c2">
<td><tt>20:53.35</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so it's definetly not the engine</tt></td>
</tr>
<tr class="c2">
<td><tt>20:53.46</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>so I think I know what to fix now</tt></td>
</tr>
<tr class="c2">
<td><tt>20:56.01</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Your engine's code did seem quite fine on this
aspect.  Would it be the callbacks?</tt></td>
</tr>
<tr class="c2">
<td><tt>21:06.02</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>no, I think it's the semaphore usage in my
camera</tt></td>
</tr>
<tr class="c2">
<td><tt>21:06.17</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I'm going running now, so I'll investigate in
an hour</tt></td>
</tr>
<tr class="c2">
<td><tt>21:07.19</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>and indeed it was</tt></td>
</tr>
<tr class="c2">
<td><tt>21:07.50</tt></td>
<td><span class="c3"><tt>Twingy</tt></span></td>
<td width="100%"><tt>I must've been pinching  a nerve or something
on the soft one</tt></td>
</tr>
<tr class="c2">
<td><tt>21:10.47</tt></td>
<td><span class="c1"><tt>Maloeran</tt></span></td>
<td width="100%"><tt>Eh, good</tt></td>
</tr>
<tr>
<td><tt>21:58.54</tt></td>
<td colspan="2"><tt><span class="c4">*** join/#brlcad ``Erik
(i=erik@pcp0011474399pcs.chrchv01.md.comcast.net)</span></tt></td>
</tr>
</table>
<br />
Generated by irclog2html.pl by <a href=
"mailto:jdub@NOSPAMaphid.net">Jeff Waugh</a> - find it at <a href=
"http://freshmeat.net/appindex/2000/03/28/954251322.html">freshmeat.net</a>!
Modified by <a href="http://www.Rikers.org">Tim Riker</a> to work
with <a href="http://blootbot.sourceforge.net/">blootbot</a> logs,
split per channel, etc.
</body>
</html>
