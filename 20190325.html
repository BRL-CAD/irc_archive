<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
 <title>IRC log for #brlcad on 20190325</title>
 <meta name="generator" content="irclog2html.pl">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body text="#000000" bgcolor="#ffffff">
<h1>IRC log for #brlcad on 20190325</h1>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Default -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-1563266826402652"
     data-ad-slot="5026919875"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<form action="http://www.google.com" id="cse-search-box">
  <div>
    <input type="hidden" name="cx" value="partner-pub-1563266826402652:3301963896" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<table cellspacing=3 cellpadding=2 border=0>
<tr><td><tt>00:02.51</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@43-61-133-95.pool.ukrtel.net)</font></tt></td></tr>
<tr><td><tt>00:42.43</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@43-61-133-95.pool.ukrtel.net)</font></tt></td></tr>
<tr><td><tt>00:57.09</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>01:04.00</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad LordOfBikes (~armin@dslb-088-065-188-154.088.065.pools.vodafone-ip.de)</font></tt></td></tr>
<tr><td><tt>02:25.27</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad kintel (~textual@unaffiliated/kintel)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>07:10.14</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>getting closer, but going to have to continue this debugging in a few hours with fresh eyes</tt></td></tr>
<tr><td><tt>07:28.16</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad KimK (~Kim__@2001:579:d00c:600:4a5b:39ff:fe0b:57d2)</font></tt></td></tr>
<tr><td><tt>08:44.51</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad hightower2 (~hightower@141-210.dsl.iskon.hr)</font></tt></td></tr>
<tr><td><tt>08:45.25</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad hightower2 (~hightower@unaffiliated/hightower2)</font></tt></td></tr>
<tr><td><tt>08:57.55</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@43-61-133-95.pool.ukrtel.net)</font></tt></td></tr>
<tr><td><tt>09:48.37</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee_ (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>10:39.26</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@195.20.130.10)</font></tt></td></tr>
<tr><td><tt>11:01.19</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee- (bc5c2133@gateway/web/freenode/ip.188.92.33.51)</font></tt></td></tr>
<tr><td><tt>13:38.21</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad kintel (~textual@unaffiliated/kintel)</font></tt></td></tr>
<tr><td><tt>14:14.09</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@195.20.130.10)</font></tt></td></tr>
<tr><td><tt>15:11.33</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad kintel (~textual@unaffiliated/kintel)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:34.26</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>brlcad: Don't know if they'll be any use for debugging, but I'm trying to get cache tests set up that will ensure things stay working once we hammer out the last issue(s)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:36.35</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>is there any way to make an attempt to bu_free a null pointer fatal?&nbsp;&nbsp;A quick look in the code suggests there isn't... Could we set up an environment variable or something we could set for testing purposes to make bu_free exit on attempt to free null?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:37.12</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>I noticed the test, sounds like a good plan</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:37.59</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>the usual way to catch that would be a sanity macro before the free call</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:38.51</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>if we knew where to put it...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:39.44</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>what I'm after is that spewage of bu_free message we got turning into a fatal error, because in a lot of cases things will "keep working" after that happens</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:39.45</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>fwiw, i'm debugging a db_close() failure.&nbsp;&nbsp;there's some memory management issue when two processes attempt to cache at the same time</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:40.06</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>i think that's the same bug</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:40.27</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>brlcad: cool.&nbsp;&nbsp;Hope I didn't stomp on anything - I figured I'd work on the tests this morning after I saw you were digging into the main code</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:40.45</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>easily reproduced because it only happens the first time an object is created and another process tries to create it too</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:40.53</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>working on tests is golden</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.13</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>I'm close it feels like something simple</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:41.46</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>so you're seeing an actual multi-process issue (e.g. two different programs at the same time), or just multiple threads?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:42.32</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>in theory, it can happen with two threads or processes -- it's whenever two try to cache at the same time.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:42.42</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt><font color="#CC00CC">nods</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:42.52</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>whoever gets there second ends up with bad dbip book-keeping reliably</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:43.27</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Multiple processes playing in the same files, without file locking? Neat, a bit tricky too</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:43.29</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>I'm probably adding the wrong dbip to the hash or something stupid</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:43.54</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>Stragus: an efficient way to go bald, so far</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:44.17</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>Stragus: locking is fine, if we need to - we're just missing a guard somewhere</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:44.24</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>Stragus: yeah, that part actually works alright -- it's when they go to clean up their memory ... on of them stashed a bad pointer</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:45.00</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>I don't think this is a guard issue, there's no indication -- it seems like a straight up book-keeping bug</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:45.14</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>ah, k</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:45.24</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>could be, of course, but so far it's straight up repeatable, not raced</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:46.09</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt><font color="#CC00CC">considers whether a raced bug might be hiding behind the current straight up failure, shudders, and goes back to test writing</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:47.38</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>So it's just memory and unrelated to file locking/access... If you get desperate and want to try something new, I wrote a LD_PRELOAD memory debugger: putting each allocation between pages that core dump on access, tracking all memory allocations and their full backtraces (handy to trace memory leaks, etc.), and so on</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:47.57</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>I actually use it all the time, it beats Valgrind for me</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:48.16</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>I probably shouldn't be doing two rtips at once in the same program... I don't know that that is actually intended to work...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:48.19</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>Stragus: cool</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:48.24</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>is that up on your site?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:49.54</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>I never really shared it anywhere. I wrote that once out of desperation to track a bug</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:51.16</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>Stragus: you should sent it to the Valigrind people and have them build it in.&nbsp;&nbsp;--totally-desperate or some such option ;-)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:52.07</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Eheh. Technically Valgrind is fancier, but&nbsp;&nbsp;#1 Valgrind is too slow for many uses&nbsp;&nbsp;#2 I want to core dump INSTANTLY when I access where I shouldn't, not some time later "when I use the value" as decided by Valgrind</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:52.39</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt><font color="#CC00CC">nods</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:52.40</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Ah, and #3&nbsp;&nbsp;I like getting a detailed list of all memory allocations at any time while the code is running</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:53.01</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Like this: <a href="http://www.rayforce.net/mmdebug.log">http://www.rayforce.net/mmdebug.log</a></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>15:54.51</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>nice</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:04.04</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>think I just found the bug</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:04.18</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt><font color="#CC00CC">cheers for bug-crushing brlcad</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:05.11</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>just a a stray db_close() where we shouldn't be closing anything</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:06.15</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Sounds like a typical double-free. I thought you would a debugging mode #define for bu_alloc and bu_free (hence the wrappers), catching that stuff and more</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:06.30</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>you would +have</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:06.33</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>starseeker: simultaneous rtips should work just fine...</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:10.37</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>Stragus: a bit more complicated. this isn't allocation-related, it's a handle to reference counted memory mapped files that are stored in a hash -- code pulled the handle from the hash to see if it was there... closed it (mind you it's still in the hash), then went to use it again.&nbsp;&nbsp;that was all good and fine until it came time to clean up and shut down, and a bit of naive code simply iterated over the </tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:10.42</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>hash and closed everything (because it should only be there if it's open)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:11.14</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>could've caught that it was already closed, but that would have just masked the mistake.&nbsp;&nbsp;just took a bit to find where it was getting closd prematurely</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:12.07</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt><font color="#CC00CC">nods</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:20.45</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>Stragus: sounds like you implemented _FORTIFY_SOURCE=2</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:21.10</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>mind you, with some fancy stack printing instead of just detect and abort</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:24.47</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>I thought _FORTIFY_SOURCE was only for glibc calls?</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:25.09</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>forget which OS, but there was one out there (maybe openbsd, solaris, I forget) for a while whose libc had all allocations set up to intentionally incur a fault.&nbsp;&nbsp;some of that carried over to Mac with their libc as well.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:25.18</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>I want a core dump the moment I step over a byte I shouldn't, anywhere</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:25.26</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Cool</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:27.21</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>(technically, my mmdebug has mechanisms to exclude some allocations from the mmap stuff, 12288 bytes of overhead per malloc() can cause trouble)</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:28.17</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>yeah, _FORTIFY_SOURCE tries to do the least expensive and only checks when access via some call (iirc, they could have gotten more advanced), but the OS-level one was definitely any access.&nbsp;&nbsp;read one byte past a char[12] - boom, segfault.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:29.13</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Neat. Yes, I'm not surprised others have done it before, it's very handy</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:29.18</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>there was a lot of commotion back at the time because so many apps wouldn't run when they turned it on</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:29.26</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>Ahah</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:31.01</tt></td><td><font color="#7373da"><tt>Stragus</tt></font></td><td width="100%"><tt>I had to put some exclusion mechanisms for various reasons, for example the NVIDIA GL drivers malloc'ed 3 bytes then later read 4 bytes from that address</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:36.53</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>probably openbsd, that sounds like their style</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>16:43.55</tt></td><td><font color="#67c567"><tt>brlcad</tt></font></td><td width="100%"><tt>starseeker: just slammed through a bunch of tests including deleting cache mid-processings, read-only, dozens of simultaneous collisions ... so far looking good.</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:49.06</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>brlcad: sweet</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:49.33</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>I've got at least some of the tests in place (not actually shooting the rays yet, but the cache bit is there)</tt></td></tr>
<tr><td><tt>19:49.59</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@48-10-132-95.pool.ukrtel.net)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>19:50.02</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>I haven't figured out what I'm doing wrong with the rtip yet</tt></td></tr>
<tr><td><tt>19:53.00</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
<tr><td><tt>20:09.05</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad kintel (~textual@unaffiliated/kintel)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>20:36.35</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>brlcad: are you able to run the cache test rt_cache 5 10 successfully?</tt></td></tr>
<tr><td><tt>20:51.56</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@48-10-132-95.pool.ukrtel.net)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>20:52.16</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>hang on, I'm doing something wrong with mappedfile.c...</tt></td></tr>
<tr><td><tt>21:23.01</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad merzo (~merzo@48-10-132-95.pool.ukrtel.net)</font></tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>21:39.27</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>brlcad: OK, r72749 and r72751 may do it - need to try some real tests and have a go on Windows</tt></td></tr>
<tr bgcolor="#eeeeee"><td><tt>21:44.47</tt></td><td><font color="#d771d7"><tt>starseeker</tt></font></td><td width="100%"><tt>brlcad: should the rt_cache tests follow through and actually do a shot, or do we not need that level of validation?&nbsp;&nbsp;(I'm going to add some basic sanity checks on number of files present, but setting up the all-up shot validation is a bit more infrastructure...)</tt></td></tr>
<tr><td><tt>23:23.38</tt></td><td colspan=2><tt><font color="#009900">*** join/#brlcad teepee (~teepee@unaffiliated/teepee)</font></tt></td></tr>
</table>

<br>Generated by irclog2html.pl
Modified by <a href="http://Rikers.org">Tim Riker</a> to work with
<a href="http://infobot.sourceforge.net/">infobot</a>.
</body></html>
